MVP 收口计划（详细版）

下面这版按“能稳定上线、可快速迭代、技术债可控”来设计，默认周期 10~15 个工作日。

一、MVP 收口标准（必须全部通过）

API 契约统一

前端请求仅发送新字段：questionText、questionTypeEnum、data。

后端对外文档只声明新字段，旧字段仅做输入兼容，不作为正式契约。

所有核心接口（创建/更新/查询/AI生成）返回新字段完整可用。

数据一致性

任意入口写入后，数据库中 QuestionDataJson 与 QuestionType 保持一致。

旧字段写入时能被后端正确转换到新结构。

读取时前端不依赖旧字段也能正确展示和作答。

关键链路可用

手动创建题目：单选/多选/判断/填空/简答全部可用。

AI 生成题目：生成、落库、列表展示、编辑更新可闭环。

题库详情、筛选、测验链路不因新模型回归。

质量门禁

后端单测和集成测试通过（至少覆盖 DTO 映射、兼容转换、迁移后读取）。

前端至少有关键流程的接口联调验证记录。

不允许 P0/P1 缺陷带入上线。

发布可控

有灰度或回滚方案（最少支持应用回滚与数据兼容读取）。

有最小监控：接口错误率、AI 生成失败率、创建题目失败率。

二、执行计划（10~15 天）

阶段 0：范围冻结与基线确认（Day 1）

冻结 MVP 功能范围，只保留题库管理、题目 CRUD、AI 生成、测验主链路。
定义“正式字段白名单”，明确新字段为唯一对外标准。
产出文档：MVP Scope、API Contract v1、兼容策略。
验收：产品、前端、后端三方签字确认一次。
阶段 1：契约收口（Day 2~4）

后端控制器和 DTO 统一对外响应结构，保证新字段稳定输出。
Service 层把旧字段兼容逻辑集中到单点转换器，避免散落在多个类中。
前端表单、store、api 层全部改为发送新字段。
清理前端页面中的混用逻辑（type/content 仅作显示兜底，禁止写入）。
验收：抓包验证核心接口请求体不含旧字段。
阶段 2：数据与迁移收口（Day 4~6）

设计并执行迁移校验脚本，统计转换成功率、失败样本。
对历史脏数据定义修复策略（空选项、无效答案、题型不匹配）。
增加启动期健康检查：发现 QuestionType 与 QuestionDataJson 不一致时记录告警。
验收：历史数据转换成功率达到目标（建议 >=99.5%），剩余人工修复有清单。
阶段 3：测试收口（Day 6~10）

后端测试最小集合：
DTO -> Entity 新旧字段映射测试。
Entity -> DTO 回填测试。
AI 生成落库一致性测试。
迁移后读取兼容测试。
前端联调回归最小集合：
5 种题型创建/编辑/删除。
列表筛选与详情展示。
AI 生成后直接进入题库查看与编辑。
测验答题与判分。
验收：测试用例通过率 100%，P0/P1 缺陷为 0。
阶段 4：发布准备与灰度（Day 10~12）

发布前检查清单（配置、迁移、备份、监控、告警阈值）。
小流量灰度，重点观察 24 小时。
若指标异常，按回滚预案执行。
验收：灰度期核心指标稳定，进入全量发布。
阶段 5：技术债管理（Day 12~15，可并行）

标记旧字段退役计划（例如 2 个版本后移除）。
建立“兼容代码删除清单”和时间点。
发布后复盘，确认下一版本收敛项。
三、建议的量化 KPI（MVP 是否可上线）

题目创建成功率 >= 99.9%
AI 生成成功率 >= 95%（按可用配置计）
题目读取/列表接口 95 分位响应时间 <= 500ms（不含 AI 生成）
线上 P0/P1 缺陷 = 0
数据一致性检查通过率 >= 99.5%
四、风险与对策

风险：新旧字段长期并存导致再次漂移

对策：兼容逻辑集中单点实现，禁止业务层重复转换。

风险：历史数据质量不一致

对策：迁移前跑盘点脚本，先修复高频脏数据模式。

风险：前端页面遗漏旧字段写入

对策：在 API 层加请求体校验拦截，出现旧字段直接报警。

风险：AI 返回结构波动

对策：统一解析器 + 严格校验 + 降级兜底（失败不入库）。